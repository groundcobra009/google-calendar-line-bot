# 📅 GoogleカレンダーLINEbot

GoogleカレンダーのイベントをLINEに自動送信するbotです。スプレッドシートのUIから簡単に設定でき、手動送信と自動送信（朝8時）の両方に対応しています。

## 🚀 機能

- **スプレッドシートUI**: カレンダーIDやLINE設定をGUIで簡単設定
- **手動送信**: メニューからワンクリックで今日の予定を送信
- **自動送信**: 毎日朝8時に自動で予定を送信
- **Webhook対応**: LINEからのメッセージに応答
- **多機能**: 予定の詳細（時間、場所、説明）も含めて送信

## 📋 事前準備

### 1. LINE Developers アカウント設定

1. [LINE Developers](https://developers.line.biz/) にアクセス
2. チャンネルを作成（Messaging API）
3. 以下の情報を取得：
   - **Channel Access Token**
   - **User ID**（LINE公式アカウントを友達追加して取得）

### 2. Googleカレンダー設定

1. 使用したいGoogleカレンダーの設定を開く
2. 「カレンダーの統合」セクションで **カレンダーID** を取得
   - 例: `your-email@gmail.com` または `xxxxxxxxxx@group.calendar.google.com`

## 🛠️ セットアップ手順

### Step 1: GASプロジェクトの作成

1. [Google Apps Script](https://script.google.com/) にアクセス
2. 「新しいプロジェクト」を作成
3. `Code.gs` の内容を全て削除し、提供されたコードをコピー&ペースト
4. `appsscript.json` ファイルを作成し、マニフェスト内容をペースト

### Step 2: スプレッドシートの作成

1. [Google Sheets](https://sheets.google.com/) で新しいスプレッドシートを作成
2. GASプロジェクトで「リソース」→「このスクリプトに関連付けられたスプレッドシートを表示」
3. または、既存のスプレッドシートにGASプロジェクトをバインド

### Step 3: 初期設定

1. スプレッドシートを開く
2. メニューバーに「📅 カレンダーLINEbot」が表示されることを確認
3. 「📝 設定シートを初期化」をクリック
4. 「カレンダー設定」シートで以下を入力：
   - **B1**: GoogleカレンダーID
   - **B2**: LINE Channel Access Token
   - **B3**: LINE User ID
   - **B4**: Webhook Verify Token（任意）

### Step 4: 権限の許可

1. 初回実行時にGoogleの権限許可画面が表示されます
2. 以下の権限を許可：
   - Googleスプレッドシートへのアクセス
   - Googleカレンダーの読み取り
   - 外部サービスへのリクエスト

### Step 5: Webアプリとしてデプロイ

1. GASエディタで「デプロイ」→「新しいデプロイ」
2. 種類を「ウェブアプリ」に設定
3. 設定：
   - **実行者**: 自分
   - **アクセスできるユーザー**: 全員
4. 「デプロイ」をクリック
5. **ウェブアプリのURL**をコピー（Webhook URL）

### Step 6: LINE Webhook設定

1. LINE Developers コンソールに戻る
2. 「Messaging API設定」タブを開く
3. **Webhook URL**に Step 5 でコピーしたURLを設定
4. **Webhookの利用**: オン
5. **応答メッセージ**: オフ（botが応答するため）

## 🎯 使用方法

### 手動送信

1. スプレッドシートのメニュー「📅 カレンダーLINEbot」→「📤 今日のイベントを手動送信」
2. 今日の予定がLINEに送信されます

### 自動送信設定

1. メニュー「⏰ 朝8時の自動送信を設定」をクリック
2. 毎日朝8時に自動で予定が送信されます
3. 停止したい場合は「❌ 自動送信を停止」をクリック

### LINEbotとの対話

LINE公式アカウントに以下のメッセージを送信：

- `今日の予定` または `予定`: 今日の予定を表示
- `ヘルプ` または `help`: 使い方を表示
- その他のメッセージ: 簡単な案内を表示

## 📧 送信メッセージの例

```
📅 2024年06月20日(木)の予定

1. 朝の会議
⏰ 09:00 - 10:00
📍 会議室A
📝 プロジェクトの進捗報告

2. ランチミーティング
⏰ 12:00 - 13:00
📍 レストラン○○

3. 夕方の打ち合わせ
⏰ 17:00 - 18:00
```

## 🔧 トラブルシューティング

### よくある問題

1. **「カレンダーIDが見つかりません」エラー**
   - カレンダーIDが正しいか確認
   - カレンダーの共有設定を確認

2. **LINE送信エラー**
   - Channel Access Tokenが正しいか確認
   - User IDが正しいか確認

3. **権限エラー**
   - GASの権限許可を再実行
   - スプレッドシートとカレンダーへのアクセス権限を確認

### デバッグ方法

1. GASエディタの「実行」ボタンでテスト実行
2. 「testGetTodayEvents」関数でカレンダー取得をテスト
3. 「表示」→「ログ」でエラー詳細を確認

## 🔒 セキュリティ

- **アクセストークン**: スプレッドシートに保存するため、適切な共有設定を行ってください
- **Webhook検証**: セキュリティを高めたい場合は Verify Token を設定してください
- **権限管理**: 必要最小限の権限のみを許可しています

## 📝 カスタマイズ

### メッセージ形式の変更

`createLineMessage` 関数を編集してメッセージ形式をカスタマイズできます。

### 送信時間の変更

`setupMorningTrigger` 関数の `.atHour(8)` 部分を変更して送信時間を調整できます。

### 追加機能

- 明日の予定取得
- 週間予定の送信
- 特定キーワードでの予定フィルタリング

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 🤝 貢献

バグ報告や機能追加の提案は、GitHubのIssueでお知らせください。

## 📞 サポート

設定や使用方法でご不明な点がある場合は、READMEを参照いただくか、サポートチャンネルまでお問い合わせください。 